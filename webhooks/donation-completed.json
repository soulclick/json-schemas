{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Donation Completed Event",
  "description": "Schema for donation.completed webhook events",
  "required": ["id", "event", "created_at", "environment", "data"],
  "properties": {
    "id": {
      "type": "integer",
      "description": "Unique event identifier"
    },
    "event": {
      "type": "string",
      "enum": ["donation.completed"],
      "description": "Event type"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when event was created"
    },
    "environment": {
      "type": "string",
      "enum": ["test", "stage", "prod"],
      "description": "Environment where event occurred"
    },
    "data": {
      "type": "object",
      "required": ["donation"],
      "properties": {
        "donation": {
          "type": "object",
          "required": [
            "id",
            "created_at",
            "amount",
            "currency",
            "campaign",
            "purpose",
            "donor",
            "payment"
          ],
          "properties": {
            "id": {
              "type": "integer",
              "description": "Unique donation identifier"
            },
            "created_at": {
              "type": "string",
              "format": "date-time",
              "description": "ISO 8601 timestamp when donation was created"
            },
            "amount": {
              "type": "number",
              "minimum": 0,
              "multipleOf": 0.01,
              "description": "Donation amount"
            },
            "currency": {
              "type": "string",
              "pattern": "^[A-Z]{3}$",
              "description": "ISO 4217 currency code"
            },
            "campaign": {
              "type": "string",
              "description": "Campaign or product name"
            },
            "purpose": {
              "type": "string",
              "description": "Donation purpose or category"
            },
            "donor": {
              "type": "object",
              "required": [
                "first_name",
                "last_name",
                "email",
                "street",
                "street_number",
                "city",
                "postal_code",
                "country",
                "language"
              ],
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Donor title (optional)"
                },
                "first_name": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Donor first name"
                },
                "last_name": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Donor last name"
                },
                "company": {
                  "type": "string",
                  "description": "Company name (optional)"
                },
                "street": {
                  "type": "string",
                  "description": "Street name"
                },
                "street_number": {
                  "type": "string",
                  "description": "Street number"
                },
                "po_box": {
                  "type": "string",
                  "description": "PO Box (optional)"
                },
                "city": {
                  "type": "string",
                  "description": "City"
                },
                "postal_code": {
                  "type": "string",
                  "description": "Postal code"
                },
                "country": {
                  "type": "string",
                  "pattern": "^[A-Z]{2}$",
                  "description": "ISO 3166-1 alpha-2 country code"
                },
                "email": {
                  "type": "string",
                  "format": "email",
                  "description": "Donor email address"
                },
                "language": {
                  "type": "string",
                  "pattern": "^[a-z]{2}$",
                  "description": "Donor's preferred language (ISO 639-1 language code)"
                }
              }
            },
            "payment": {
              "type": "object",
              "required": ["method", "status"],
              "properties": {
                "method": {
                  "type": "string",
                  "enum": [
                    "twint",
                    "visa",
                    "mastercard",
                    "postfinance",
                    "invoice"
                  ],
                  "description": "Payment method used"
                },
                "status": {
                  "type": "string",
                  "enum": ["completed", "pending", "failed"],
                  "description": "Payment status"
                }
              }
            },
            "invoice": {
              "type": "string",
              "description": "Invoice number (null for non-invoice payments)"
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "id": 1,
      "event": "donation.completed",
      "created_at": "2025-08-27T14:04:39Z",
      "environment": "prod",
      "data": {
        "donation": {
          "id": 188,
          "created_at": "2025-08-25T10:30:00Z",
          "amount": 51.05,
          "currency": "CHF",
          "campaign": "Schule statt Fabrik – Hoffnung statt Ausbeutung",
          "purpose": "Freie Spende",
          "donor": {
            "title": "Frau",
            "first_name": "Jana",
            "last_name": "Dockter",
            "street": "Jubiläumsstrasse",
            "street_number": "23",
            "city": "Bern",
            "postal_code": "3005",
            "country": "CH",
            "language": "de",
            "email": "janadockter@web.de"
          },
          "payment": {
            "method": "twint",
            "status": "completed"
          },
          "invoice": null
        }
      }
    },
    {
      "id": 2,
      "event": "donation.completed",
      "created_at": "2025-08-27T15:22:15Z",
      "environment": "prod",
      "data": {
        "donation": {
          "id": 189,
          "created_at": "2025-08-27T09:45:00Z",
          "amount": 100.0,
          "currency": "CHF",
          "campaign": "Wildhunde Patenschaft",
          "purpose": "Tierpatenschaft",
          "donor": {
            "first_name": "Max",
            "last_name": "Müller",
            "company": "Tech Solutions AG",
            "street": "Bahnhofstrasse",
            "street_number": "1",
            "city": "Zürich",
            "postal_code": "8001",
            "country": "CH",
            "language": "de",
            "email": "max.mueller@example.ch"
          },
          "payment": {
            "method": "visa",
            "status": "completed"
          },
          "invoice": null
        }
      }
    },
    {
      "id": 3,
      "event": "donation.completed",
      "created_at": "2025-08-27T09:15:30Z",
      "environment": "prod",
      "data": {
        "donation": {
          "id": 190,
          "created_at": "2025-08-27T08:20:00Z",
          "amount": 250.0,
          "currency": "CHF",
          "campaign": "Bildung für alle",
          "purpose": "Bildungsprojekt",
          "donor": {
            "title": "Herr",
            "first_name": "Peter",
            "last_name": "Schmidt",
            "street": "Musterstrasse",
            "street_number": "42",
            "po_box": "Postfach 1234",
            "city": "Basel",
            "postal_code": "4000",
            "country": "CH",
            "language": "fr",
            "email": "peter.schmidt@company.ch"
          },
          "payment": {
            "method": "invoice",
            "status": "pending"
          },
          "invoice": "INV-2025-001190"
        }
      }
    }
  ]
}
