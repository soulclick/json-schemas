{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Shop Order Completed Event",
  "description": "Schema for shop_order.completed webhook events",
  "required": ["id", "event", "created_at", "environment", "data"],
  "properties": {
    "id": {
      "type": "integer",
      "description": "Unique event identifier"
    },
    "event": {
      "type": "string",
      "enum": ["shop_order.completed"],
      "description": "Event type"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when event was created"
    },
    "environment": {
      "type": "string",
      "enum": ["test", "stage", "prod"],
      "description": "Environment where event occurred"
    },
    "data": {
      "type": "object",
      "required": ["shop_order"],
      "properties": {
        "shop_order": {
          "type": "object",
          "required": [
            "id",
            "created_at",
            "customer",
            "invoice_address",
            "delivery_address",
            "items",
            "currency",
            "total_price_gross",
            "total_price_net",
            "total_vat",
            "total_discount",
            "payment",
            "shipping"
          ],
          "properties": {
            "id": {
              "type": "string",
              "description": "Order number (unique order identifier)"
            },
            "created_at": {
              "type": "string",
              "format": "date-time",
              "description": "ISO 8601 timestamp when order was created"
            },
            "customer": {
              "type": "object",
              "required": [
                "email",
                "language",
                "street",
                "street_number",
                "postal_code",
                "city",
                "country"
              ],
              "properties": {
                "gender": {
                  "type": "string",
                  "enum": ["male", "female", "non-binary", "prefer-not-to-say"],
                  "description": "Customer gender (optional)"
                },
                "first_name": {
                  "type": "string",
                  "description": "First name"
                },
                "last_name": {
                  "type": "string",
                  "description": "Last name"
                },
                "email": {
                  "type": "string",
                  "format": "email",
                  "description": "Customer email address"
                },
                "phone": {
                  "type": ["string", "null"],
                  "description": "Customer phone number"
                },
                "company": {
                  "type": "string",
                  "description": "Company name (optional)"
                },
                "department": {
                  "type": "string",
                  "description": "Department (optional)"
                },
                "care_of": {
                  "type": "string",
                  "description": "Care of / attention to (z.Hd.) - optional"
                },
                "po_box": {
                  "type": "string",
                  "description": "PO Box (optional)"
                },
                "street": {
                  "type": "string",
                  "description": "Street name"
                },
                "street_number": {
                  "type": "string",
                  "description": "Street number"
                },
                "postal_code": {
                  "type": "string",
                  "description": "Postal code"
                },
                "city": {
                  "type": "string",
                  "description": "City"
                },
                "country": {
                  "type": "string",
                  "pattern": "^[A-Z]{2}$",
                  "description": "ISO 3166-1 alpha-2 country code"
                },
                "language": {
                  "type": "string",
                  "pattern": "^[a-z]{2}$",
                  "description": "Customer's preferred language (ISO 639-1 language code)"
                }
              }
            },
            "items": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": [
                  "article_number",
                  "quantity",
                  "unit_price_net",
                  "unit_price_gross",
                  "total_price_gross"
                ],
                "properties": {
                  "article_number": {
                    "type": "string",
                    "description": "Article number"
                  },
                  "quantity": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Quantity ordered"
                  },
                  "unit_price_net": {
                    "type": "number",
                    "minimum": 0,
                    "multipleOf": 0.01,
                    "description": "Unit price without tax"
                  },
                  "unit_price_gross": {
                    "type": "number",
                    "minimum": 0,
                    "multipleOf": 0.01,
                    "description": "Unit price including tax"
                  },
                  "discount_percentage": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 100,
                    "description": "Discount percentage applied to this item"
                  },
                  "total_price_gross": {
                    "type": "number",
                    "minimum": 0,
                    "multipleOf": 0.01,
                    "description": "Total price for this item including tax"
                  }
                }
              }
            },
            "delivery_address": {
              "type": "object",
              "required": [
                "street",
                "street_number",
                "postal_code",
                "city",
                "country"
              ],
              "properties": {
                "first_name": {
                  "type": "string",
                  "description": "First name"
                },
                "last_name": {
                  "type": "string",
                  "description": "Last name"
                },
                "company": {
                  "type": "string",
                  "description": "Company name (optional)"
                },
                "department": {
                  "type": "string",
                  "description": "Department (optional)"
                },
                "care_of": {
                  "type": "string",
                  "description": "Care of / attention to (z.Hd.) - optional"
                },
                "po_box": {
                  "type": "string",
                  "description": "PO Box (optional)"
                },
                "street": {
                  "type": "string",
                  "description": "Street name"
                },
                "street_number": {
                  "type": "string",
                  "description": "Street number"
                },
                "postal_code": {
                  "type": "string",
                  "description": "Postal code"
                },
                "city": {
                  "type": "string",
                  "description": "City"
                },
                "country": {
                  "type": "string",
                  "pattern": "^[A-Z]{2}$",
                  "description": "ISO 3166-1 alpha-2 country code"
                }
              }
            },
            "invoice_address": {
              "type": "object",
              "required": [
                "street",
                "street_number",
                "postal_code",
                "city",
                "country"
              ],
              "properties": {
                "first_name": {
                  "type": "string",
                  "description": "First name"
                },
                "last_name": {
                  "type": "string",
                  "description": "Last name"
                },
                "company": {
                  "type": "string",
                  "description": "Company name (optional)"
                },
                "department": {
                  "type": "string",
                  "description": "Department (optional)"
                },
                "care_of": {
                  "type": "string",
                  "description": "Care of / attention to (z.Hd.) - optional"
                },
                "po_box": {
                  "type": "string",
                  "description": "PO Box (optional)"
                },
                "street": {
                  "type": "string",
                  "description": "Street name"
                },
                "street_number": {
                  "type": "string",
                  "description": "Street number"
                },
                "postal_code": {
                  "type": "string",
                  "description": "Postal code"
                },
                "city": {
                  "type": "string",
                  "description": "City"
                },
                "country": {
                  "type": "string",
                  "pattern": "^[A-Z]{2}$",
                  "description": "ISO 3166-1 alpha-2 country code"
                }
              }
            },
            "currency": {
              "type": "string",
              "pattern": "^[A-Z]{3}$",
              "description": "ISO 4217 currency code"
            },
            "total_price_gross": {
              "type": "number",
              "minimum": 0,
              "multipleOf": 0.01,
              "description": "Final total including tax and shipping"
            },
            "total_price_net": {
              "type": "number",
              "minimum": 0,
              "multipleOf": 0.01,
              "description": "Total price without tax and shipping"
            },
            "total_vat": {
              "type": "number",
              "minimum": 0,
              "multipleOf": 0.01,
              "description": "Total VAT/tax amount"
            },
            "total_discount": {
              "type": "number",
              "minimum": 0,
              "multipleOf": 0.01,
              "description": "Total discount amount applied to order"
            },
            "payment": {
              "type": "object",
              "required": ["transaction_id", "method", "status"],
              "properties": {
                "transaction_id": {
                  "type": "string",
                  "description": "Payment processor transaction identifier"
                },
                "method": {
                  "type": "string",
                  "enum": [
                    "TWI",
                    "PAY",
                    "PFC",
                    "PEF",
                    "VIS",
                    "ECA",
                    "APL",
                    "PAP",
                    "INV",
                    "AMX",
                    "ALP",
                    "AZP",
                    "CFY",
                    "KLN",
                    "DIB",
                    "PSC",
                    "REK",
                    "SAM",
                    "ELV"
                  ],
                  "description": "Payment method code (see https://docs.datatrans.ch/docs/payment-methods)"
                },
                "status": {
                  "type": "string",
                  "enum": ["completed", "pending", "failed"],
                  "description": "Payment status"
                }
              }
            },
            "shipping": {
              "type": "object",
              "required": ["cost", "method"],
              "properties": {
                "cost": {
                  "type": "number",
                  "minimum": 0,
                  "multipleOf": 0.01,
                  "description": "Shipping cost"
                },
                "method": {
                  "type": "string",
                  "description": "Shipping method"
                }
              }
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "id": 1,
      "event": "shop_order.completed",
      "created_at": "2025-08-29T14:04:39Z",
      "environment": "prod",
      "data": {
        "shop_order": {
          "id": "2708202500000",
          "created_at": "2025-08-27T13:17:47Z",
          "customer": {
            "type": "guest",
            "email": "myriam.udry@gmail.com",
            "language": "fr"
          },
          "items": [
            {
              "product_id": 86,
              "description": "Kleber \"Rund um die Welt\"",
              "article_number": "6304",
              "quantity": 12,
              "unit_amount": 0.0,
              "amount_total": 0.0
            },
            {
              "product_id": 18,
              "description": "Missions-Rosenkranz",
              "article_number": "3598",
              "quantity": 12,
              "unit_amount": 5.0,
              "amount_total": 60.0
            }
          ],
          "delivery_address": {
            "gender": "female",
            "first_name": "Myriam",
            "last_name": "Udry",
            "care_of": "",
            "department": "",
            "street": "Chemin des Courtis",
            "street_number": "2a",
            "po_box": "",
            "postal_code": "1976",
            "city": "Daillon",
            "country": "CH"
          },
          "invoice_address": {
            "company_name": "Tech Solutions AG",
            "street": "Bahnhofstrasse",
            "street_number": "1",
            "postal_code": "8001",
            "city": "Zürich",
            "country": "CH"
          },
          "currency": "CHF",
          "amount_subtotal": 60.0,
          "amount_discount": 5.75,
          "amount_tax": 5.75,
          "amount_total": 72.0,
          "payment": {
            "method": "twint",
            "status": "completed"
          },
          "shipping": {
            "method": "Service-Pauschale B-Post Paket",
            "cost": 12.0
          }
        }
      }
    },
    {
      "id": 2,
      "event": "shop_order.completed",
      "created_at": "2025-08-29T15:22:15Z",
      "environment": "prod",
      "data": {
        "shop_order": {
          "id": "2708202500002",
          "created_at": "2025-08-27T16:37:20Z",
          "customer": {
            "type": "registered",
            "email": "sanela.zeba@kath-berneck.ch",
            "language": "de"
          },
          "items": [
            {
              "product_id": 45,
              "description": "Sample Product",
              "article_number": "9104",
              "quantity": 1,
              "unit_amount": 0.0,
              "amount_total": 0.0
            }
          ],
          "delivery_address": {
            "gender": "female",
            "first_name": "",
            "last_name": "",
            "company_name": "Sanela Zeba",
            "care_of": "",
            "department": "",
            "street": "Büntstrasse",
            "street_number": "4",
            "po_box": "",
            "postal_code": "9442",
            "city": "Berneck",
            "country": "CH"
          },
          "invoice_address": {
            "gender": "female",
            "first_name": "",
            "last_name": "",
            "company_name": "Sanela Zeba",
            "care_of": "",
            "department": "",
            "street": "Büntstrasse",
            "street_number": "4",
            "po_box": "",
            "postal_code": "9442",
            "city": "Berneck",
            "country": "CH"
          },
          "currency": "CHF",
          "amount_subtotal": 0.0,
          "amount_discount": 0.0,
          "amount_tax": 0.0,
          "amount_total": 0.0,
          "payment": {
            "method": "invoice",
            "status": "pending"
          },
          "shipping": {
            "method": "Service-Pauschale B-Post Paket",
            "cost": 0.0
          }
        }
      }
    }
  ]
}
